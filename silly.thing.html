<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>silly Bot</title>
  <link rel="icon" href="æ“·å–.PNG">
<style>
body {
  margin: 0;
  font-family: Arial;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f0f2f5;
  transition: 0.3s;
}
body.dark { background:#121212; color:#eee; }

#top-bar {
  position: fixed;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  z-index: 1000;
}
#top-bar button, #top-bar select {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

#chat-container {
  flex: 1;
  padding: 70px 15px 15px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background-size: cover;
  background-position: center;
}

.message {
  max-width: 70%;
  padding: 10px 14px;
  border-radius: 12px;
}
.user { align-self: flex-end; background:#4e8cff; color:white; }
.bot { align-self: flex-start; background:white; }

body.dark .bot { background:#1e1e1e; }

.avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 6px;
}

#input-area {
  display: flex;
  padding: 10px;
  background: white;
}
body.dark #input-area { background:#1e1e1e; }

#text-input {
  flex: 1;
  padding: 8px;
}

#settings-popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.4);
  display: none;
  justify-content: center;
  align-items: center;
}
#settings-box {
  background: white;
  padding: 20px;
  width: 320px;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
body.dark #settings-box { background:#1e1e1e; color:#eee; }

</style>
</head>

<body>

<div id="top-bar">
  <button id="settings-btn">âš™ï¸</button>
  <button id="dark-btn">ğŸŒ™</button>
  <button id="new-chat">ğŸ†•</button>
  <select id="chat-select"></select>
</div>

<div id="chat-container"></div>

<div id="input-area">
  <input id="text-input" placeholder="è¼¸å…¥è¨Šæ¯..." />
  <button id="send-btn">é€å‡º</button>
</div>

<!-- è¨­å®š -->
<div id="settings-popup">
<div id="settings-box">
  <h3>è¨­å®š</h3>

  <!-- ã€æ–°å¢ã€‘Bot åå­— -->
  <label>Bot åå­—</label>
  <input id="bot-name">

  <!-- ã€æ–°å¢ã€‘èŠå¤©åç¨± -->
  <label>èŠå¤©åç¨±</label>
  <input id="chat-name">

  <!-- ã€æ–°å¢ã€‘Bot é ­åƒè£åˆ‡ -->
  <label>Bot é ­åƒ</label>
  <input type="file" id="bot-img" accept="image/*">
  <canvas id="crop" width="200" height="200" style="border:1px solid #ccc;"></canvas>
  <input type="range" id="zoom" min="1" max="3" step="0.01" value="1">
  <button id="apply-avatar">å¥—ç”¨é ­åƒ</button>

  <!-- ã€æ–°å¢ã€‘èƒŒæ™¯ä¸Šå‚³ -->
  <label>èŠå¤©å®¤èƒŒæ™¯</label>
  <input type="file" id="bg-img" accept="image/*">
  <button id="clear-bg">ç§»é™¤èƒŒæ™¯</button>

  <button id="save-settings">å„²å­˜</button>
</div>
</div>

<script>
window.onload = () => {
const chat = document.getElementById("chat-container");
const input = document.getElementById("text-input");

let botName = localStorage.getItem("botName") || "Bot";
let botAvatar = localStorage.getItem("botAvatar") || "";
let chats = JSON.parse(localStorage.getItem("chats") || "{}");
let chatNames = JSON.parse(localStorage.getItem("chatNames") || "{}");
let currentChat = localStorage.getItem("currentChat") || createChat();

/* ã€æ–°å¢ã€‘Bot å›è¦†åˆ—è¡¨ */
const botReplies = [
  "è›¤", "æˆ‘ä¸æƒ³æ€è€ƒ(ï¼Ÿ", "é€™ä¸é‡è¦ï¼(å§", "å•Šå°ï¼Œä½ å°ï¼Œæ‰æ€ª", "æˆ‘ä¸çŸ¥é“æ¬¸ğŸ˜¦", "å†èªªä¸€æ¬¡ï¼Ÿ", ":3", "XD", ":/", "å…ˆä¸è¦èª’...", "._.","å¥½ç´¯å–”...",";3","è¦æ­»äº†å–”XP","è«‹å®¹è¨±æˆ‘æ¶ˆå¤±ä¸€ä¸‹",":0",":D"
];

/* å»ºç«‹æ–°èŠå¤© */
function createChat() {
  const id = "chat-" + Date.now();
  chats[id] = [];
  save();
  return id;
}

/* å­˜æª” */
function save() {
  localStorage.setItem("chats", JSON.stringify(chats));
  localStorage.setItem("chatNames", JSON.stringify(chatNames));
  localStorage.setItem("currentChat", currentChat);
}

/* æ¸²æŸ“èŠå¤© */
function render() {
  chat.innerHTML = "";
  chats[currentChat].forEach(m => addMsg(m.text, m.sender, false));

  /* ã€æ–°å¢ã€‘å¥—ç”¨èŠå¤©èƒŒæ™¯ */
  const bg = localStorage.getItem("bg-"+currentChat);
  chat.style.backgroundImage = bg ? `url(${bg})` : "";
}

/* é¡¯ç¤ºè¨Šæ¯ */
function addMsg(text, sender, saveMsg=true) {
  const div = document.createElement("div");
  div.className = "message " + sender;

  /* ã€æ–°å¢ã€‘bot avatar */
  if (sender==="bot" && botAvatar) {
    const img = document.createElement("img");
    img.src = botAvatar;
    img.className = "avatar";
    div.appendChild(img);
  }

  div.append(text);
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;

  if (saveMsg) {
    chats[currentChat].push({text, sender});
    save();
  }
}

/* é€å‡ºè¨Šæ¯ */
document.getElementById("send-btn").onclick = () => {
  if (!input.value.trim()) return;
  addMsg(input.value,"user");
  input.value="";

  /* ã€æ–°å¢ã€‘éš¨æ©Ÿäº‚å› */
  const reply = botReplies[Math.floor(Math.random()*botReplies.length)];
  setTimeout(()=>addMsg(botName+"ï¼š"+reply,"bot"),400);
};
input.onkeydown = e => e.key==="Enter" && document.getElementById("send-btn").click();

/* æ–°èŠå¤© */
document.getElementById("new-chat").onclick = () => {
  currentChat = createChat();
  render();
  updateSelect();
};

/* ä¸‹æ‹‰é¸å–®åˆ‡æ›èŠå¤© */
function updateSelect() {
  const sel = document.getElementById("chat-select");
  sel.innerHTML="";
  Object.keys(chats).forEach(id=>{
    const o=document.createElement("option");
    o.value=id;
    /* ã€æ–°å¢ã€‘é¡¯ç¤ºèŠå¤©åç¨± */
    o.textContent = chatNames[id]||id;
    if(id===currentChat)o.selected=true;
    sel.appendChild(o);
  });
}
document.getElementById("chat-select").onchange = e => {
  currentChat=e.target.value;
  render();
};

/* æš—è‰²æ¨¡å¼ */
document.getElementById("dark-btn").onclick = ()=>document.body.classList.toggle("dark");

/* æ‰“é–‹è¨­å®š */
document.getElementById("settings-btn").onclick = ()=>{
  document.getElementById("settings-popup").style.display="flex";
  document.getElementById("bot-name").value=botName;
  document.getElementById("chat-name").value=chatNames[currentChat]||"";
};

/* å„²å­˜è¨­å®š */
document.getElementById("save-settings").onclick = ()=>{
  botName=document.getElementById("bot-name").value||"Bot";
  chatNames[currentChat]=document.getElementById("chat-name").value;
  localStorage.setItem("botName",botName);
  save();
  updateSelect();
  document.getElementById("settings-popup").style.display="none";
};

/* ã€æ–°å¢ã€‘é ­åƒè£åˆ‡ */
const canvas=document.getElementById("crop");
const ctx=canvas.getContext("2d");
let img=new Image(),scale=1;

document.getElementById("bot-img").onchange=e=>{
  const reader=new FileReader();
  reader.onload=()=>{img.src=reader.result; img.onload=draw;};
  reader.readAsDataURL(e.target.files[0]);
};
document.getElementById("zoom").oninput=e=>{ scale=e.target.value; draw(); };
function draw(){
  ctx.clearRect(0,0,200,200);
  const s=Math.min(img.width,img.height);
  ctx.drawImage(img,(200-s*scale)/2,(200-s*scale)/2,s*scale,s*scale);
}
document.getElementById("apply-avatar").onclick=()=>{
  botAvatar=canvas.toDataURL();
  localStorage.setItem("botAvatar",botAvatar);
};

/* ã€æ–°å¢ã€‘èƒŒæ™¯ä¸Šå‚³ */
document.getElementById("bg-img").onchange=e=>{
  const reader=new FileReader();
  reader.onload=()=>{
    localStorage.setItem("bg-"+currentChat,reader.result);
    render();
  };
  reader.readAsDataURL(e.target.files[0]);
};
document.getElementById("clear-bg").onclick=()=>{
  localStorage.removeItem("bg-"+currentChat);
  render();
};

updateSelect();
render();
};
</script>
</body>
</html>
